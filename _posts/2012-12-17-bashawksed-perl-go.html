---
layout: post
title: Bash/Awk/Sed  Perl  Go
date: 2012-12-17 17:34:23.000000000 +08:00
type: post
parent_id: '0'
published: true
password: ''
status: publish
categories:
- Programming
- System
tags:
- awk
- bash
- go
- perl
- sed
meta:
  _publicize_pending: '1'
author:
  login: mcloud
  email: ''
  display_name: mcloud
  first_name: ''
  last_name: ''
---
<p>Bash/Awk/Sed  Perl  Go</p>
<p>&nbsp;</p>
<p>Bash/Awk/Sed = Perl  -- interpretive execution</p>
<p>Go - compile and go</p>
<p>&nbsp;</p>
<p>Bash – composite of commands + control structure</p>
<p>Awk/sed/perl save one line command</p>
<p>&nbsp;</p>
<p>Awk – structure text process</p>
<p>&nbsp;</p>
<p>BEGIN {         # “BEGIN{”是awk脚本开始的地方<br />
FS=":";     # FS 是在awk里指分割符的意思<br />
}</p>
<p>{                                # 接下来的“{” 是内容部分<br />
}                               # “}”    内容部分结束<br />
END {                           # “END{” 结束部分<br />
print "exit";<br />
}</p>
<p>Syntax is similar as C</p>
<p align="left"><b>表 1. 常用的 GAWK 语句</b></p>
<table summary="Table listing common GAWK actions" width="708" border="1" cellspacing="0" cellpadding="0">
<tbody>
<tr>
<td valign="top">
<p align="left"><b>语句</b></p>
</td>
<td valign="top">
<p align="left"><b>描述</b></p>
</td>
</tr>
<tr>
<td valign="top">
<p align="left">exit</p>
</td>
<td valign="top">
<p align="left">停止程序的执行，并且退出。</p>
</td>
</tr>
<tr>
<td valign="top">
<p align="left">next</p>
</td>
<td valign="top">
<p align="left">停止处理当前记录，并且前进到下一条记录。</p>
</td>
</tr>
<tr>
<td valign="top">
<p align="left">nextfile</p>
</td>
<td valign="top">
<p align="left">停止处理当前文件，并且前进到下一个文件。</p>
</td>
</tr>
<tr>
<td valign="top">
<p align="left">print</p>
</td>
<td valign="top">
<p align="left">打印使用引号括起来的文本、记录、字段和变量。（缺省情况下是打印出当前整行记录。）</p>
</td>
</tr>
<tr>
<td valign="top">
<p align="left">printf</p>
</td>
<td valign="top">
<p align="left">打印格式化文本，类似于它的 C 语言对等成分，但必须指定结尾的换行。</p>
</td>
</tr>
<tr>
<td valign="top">
<p align="left">sprintf</p>
</td>
<td valign="top">
<p align="left">返回格式化文本字符串，与 printf 使用相同的格式。</p>
</td>
</tr>
</tbody>
</table>
<p align="left"><b>表 2. 常见的 GAWK 变量</b></p>
<table summary="Table listing common GAWK variables" width="708" border="1" cellspacing="0" cellpadding="0">
<tbody>
<tr>
<td valign="top">
<p align="left"><b>变量</b></p>
</td>
<td valign="top">
<p align="left"><b>描述</b></p>
</td>
</tr>
<tr>
<td valign="top">
<p align="left">NF</p>
</td>
<td valign="top">
<p align="left">该变量包含每个记录的字段个数。</p>
</td>
</tr>
<tr>
<td valign="top">
<p align="left">NR</p>
</td>
<td valign="top">
<p align="left">该变量包含当前的记录个数。</p>
</td>
</tr>
<tr>
<td valign="top">
<p align="left">FS</p>
</td>
<td valign="top">
<p align="left">该变量是字段分隔符。</p>
</td>
</tr>
<tr>
<td valign="top">
<p align="left">RS</p>
</td>
<td valign="top">
<p align="left">该变量是记录分隔符。</p>
</td>
</tr>
<tr>
<td valign="top">
<p align="left">OFS</p>
</td>
<td valign="top">
<p align="left">该变量是输出字段分隔符。</p>
</td>
</tr>
<tr>
<td valign="top">
<p align="left">ORS</p>
</td>
<td valign="top">
<p align="left">该变量是输出记录分隔符。</p>
</td>
</tr>
<tr>
<td valign="top">
<p align="left">FILENAME</p>
</td>
<td valign="top">
<p align="left">该变量包含所读取的输入文件的名称。</p>
</td>
</tr>
<tr>
<td valign="top">
<p align="left">IGNORECASE</p>
</td>
<td valign="top">
<p align="left">当 IGNORECASE 设置为非空值，GAWK 将忽略模式匹配中的大小写。</p>
</td>
</tr>
</tbody>
</table>
<p>&nbsp;</p>
<p>Perl – powerful library, String processs – more powerful support Regex (group)</p>
<p>&nbsp;</p>
<p>&nbsp;</p>
<p>One line command – Awk Sed Perl</p>
<p>Xxx | Awk ‘{}’</p>
<p>&nbsp;</p>
<p>Go:</p>
<p>package main</p>
<p>&nbsp;</p>
<p>import (</p>
<p>"fmt"</p>
<p>"math"</p>
<p>)</p>
<p>&nbsp;</p>
<p>func main() {</p>
<p>fmt.Println("Happy", math.Pi, "Day")</p>
<p>}</p>
<ol>
<li>Basic Type</li>
</ol>
<p>1.1 Bash/Awk/Sed</p>
<p>Everything is String</p>
<p>XXX=AAAA $XXX</p>
<p>1.2 Perl</p>
<p align="left"><b>Numbers, Strings, and Quotes</b></p>
<p align="left">'This is a test.'</p>
<p align="left">"Hi there!\n"</p>
<h3>Variables</h3>
<pre><code>my $i                = 5;</code>
<code>my $pie_flavor       = 'apple';</code>
<code>my $constitution1776 = "We the People, etc.";</code></pre>
<p><em>Arrays</em> are lists of scalars. Array names begin with <code>@</code>. You define arrays by listing their contents in parentheses, separated by commas:</p>
<pre><code>my @lotto_numbers = (1, 2, 3, 4, 5, 6);  # Hey, it could happen.</code>
<code>my @months        = ("July", "August", "September");</code>
<code> </code>
<em>hashes</em> <code></code>
<code>my %days_in_month = ( "July" =&gt; 31, "August" =&gt; 31, "September" =&gt; 30 );</code></pre>
<p>&nbsp;</p>
<p>1.3 Go</p>
<p>bool</p>
<p>&nbsp;</p>
<p>string</p>
<p>&nbsp;</p>
<p>int  int8  int16  int32  int64</p>
<p>uint uint8 uint16 uint32 uint64 uintptr</p>
<p>&nbsp;</p>
<p>byte // alias for uint8</p>
<p>&nbsp;</p>
<p>rune // alias for int32</p>
<p>// represents a Unicode code point</p>
<p>&nbsp;</p>
<p>float32 float64</p>
<p>&nbsp;</p>
<p>complex64 complex128</p>
<p>&nbsp;</p>
<p>var x, y, z int = 1, 2, 3</p>
<p>c, python, java := true, false, "no!" l</p>
<ol>
<li>Special Type</li>
</ol>
<p>2.1 BASH</p>
<p>`ls -a` = let = (()) {$aaa}xxx</p>
<p>$0 $1 $2 $IFS “$aaaa”</p>
<p>${#string} ${string:position} ${string:position:length}</p>
<p>${string#substring}  shortest</p>
<p>${string##substring}  longest</p>
<p>${string/substring/replacement} first one</p>
<p>${string//substring/replacement}</p>
<p>2.2 MAP/Slice</p>
<p>var m map[string]Vertex</p>
<p>m["Bell Labs"] = Vertex{</p>
<p>40.68433, 74.39967,</p>
<p>}</p>
<p>a := make([]int, 5)</p>
<p>printSlice("a", a)</p>
<p>b := make([]int, 0, 5)</p>
<p>printSlice("b", b)</p>
<p>c := b[:2]</p>
<p>printSlice("c", c)</p>
<p>d := c[2:5]</p>
<p>printSlice("d", d)</p>
<p>type Vertex struct {</p>
<p>X, Y float64</p>
<p>}</p>
<p>&nbsp;</p>
<p>func (v *Vertex) Abs() float64 {</p>
<p>return math.Sqrt(v.X*v.X + v.Y*v.Y)</p>
<p>}</p>
<p>c := make(chan int)</p>
<p>go sum(a[:len(a)/2], c)</p>
<p>go sum(a[len(a)/2:], c)</p>
<p>x, y := &lt;-c, &lt;-c  // receive from c</p>
<ol>
<li>Complex Type</li>
</ol>
<p>3.1 Bash</p>
<p>Array: variable[xx]</p>
<ol>
<li>Control Structure</li>
</ol>
<p>4.1 Bash</p>
<ol>
<li>if [ condition ]      -e xxx file exists / - f is a file / -d is a directory / [] &amp;&amp; []</li>
</ol>
<p>then</p>
<p>commands.</p>
<p>else</p>
<p>commands</p>
<p>fi</p>
<ol>
<li>for arg in [list] (default: space as separator)</li>
</ol>
<p>do</p>
<p>command(s)...</p>
<p>done</p>
<p>for ((a=1; a &lt;= LIMIT ; a++))  # 双圆括号, 并且"LIMIT"变量前面没有"$".</p>
<p>do</p>
<p>done</p>
<ol>
<li>while [condition]</li>
</ol>
<p>do</p>
<p>command...</p>
<p>done</p>
<ol>
<li>until [condition-is-true]</li>
</ol>
<p>do</p>
<p>command...</p>
<p>done</p>
<ol>
<li>case "$variable" in</li>
</ol>
<p>"$condition1" )</p>
<p>command... ;;</p>
<p>"$condition2" )</p>
<p>command... ;;</p>
<p>esac</p>
<p>4.2 Go</p>
<p>Only for and if</p>
<p>for i := 0; i &lt; 10; i++ {</p>
<p>sum += i</p>
<p>}</p>
<p>if v := math.Pow(x, n); v &lt; lim {</p>
<p>return v</p>
<p>} else {</p>
<p>fmt.Printf("%g &gt;= %g\n", v, lim)</p>
<p>}</p>
<p>for i, v := range pow {</p>
<p>fmt.Printf("2**%d = %d\n", i, v)</p>
<p>}</p>
<p>switch os := runtime.GOOS; os {</p>
<p>case "darwin":</p>
<p>fmt.Println("OS X.")</p>
<p>case "linux":</p>
<p>fmt.Println("Linux.")</p>
<p>default:</p>
<p>// freebsd, openbsd,</p>
<p>// plan9, windows...</p>
<p>fmt.Printf("%s.", os)</p>
<p>}</p>
<p>4.3 Awk</p>
<p>Similar as C</p>
<p>4.4 perl</p>
<p>for my $i (1, 2, 3, 4, 5) {</p>
<p>say $i;</p>
<p>}</p>
<p>for my $i (@one_to_ten, 15, 20 .. $top_limit) {</p>
<p>say $i;</p>
<p>}</p>
<h3>Comparison operators</h3>
<pre><code>if ($year_according_to_computer == 1900) {</code>
<code>    say "Y2K has doomed us all!  Everyone to the compound.";</code>
<code>}</code>
<code>unless ($bank_account &gt; 0) {</code>
<code>    say "I'm broke!";</code>
<code>}</code>
<code>if ($a == 5) {</code>
<code>    say "It's five!";</code>
<code>} elsif ($a == 6) {</code>
<code>    say "It's six!";</code>
<code>} else {</code>
<code>    say "It's something else.";</code>
<code>}</code></pre>
<h3><code>while</code> and <code>until</code></h3>
<pre><code>use 5.010;</code>
<code> </code>
<code>my $count = 0;</code>
<code> </code>
<code>while ($count != 3) {</code>
<code>   $count++;</code>
<code>   say "Counting up to $count...";</code>
<code>}</code>
<code> </code>
<code>until ($count == 0) {</code>
<code>   $count--;</code>
<code>   say "Counting down to $count...";</code>
<code>}</code></pre>
<h3>String comparisons</h3>
<pre><code>use 5.010;</code>
<code> </code>
<code>my $five = 5;</code>
<code> </code>
<code>say "Numeric equality!" if $five == " 5 ";</code>
<code>say "String equality!"  if $five eq " 5 ";</code></pre>
<h3>More fun with strings</h3>
<pre><code>print substr($greeting, -6, 4);      # "Perl"</code>
<code>my $greeting = "Hello. Welcome Perl!\n";</code>
<code>my @words    = split(/ /, $greeting);   # Three items: "Hello.", "Welcome", "Perl!\n"</code></pre>
<h3>Filehandles</h3>
<p>title:</p>
<pre><code>open my $logfile, 'log.txt' or die "I couldn't get at log.txt: $!";</code>
<code> </code>
<code>my $title = &lt;$logfile&gt;;</code>
<code>print "Report Title: $title";</code>
<code> </code>
<code>print while &lt;$logfile&gt;;</code>
<code>close $logfile;</code></pre>
<h3>Writing files</h3>
<pre><code>open my $overwrite, '&gt;', 'overwrite.txt' or die "error trying to overwrite: $!";</code>
<code># Wave goodbye to the original contents.</code>
<code> </code>
<code>open my $append, '&gt;&gt;', 'append.txt' or die "error trying to append: $!";</code>
<code># Original contents still there; add to the end of the file</code></pre>
<p>&nbsp;</p>
<h3>Subs</h3>
<pre><code>use 5.010;</code>
<code> </code>
<code>sub multiply {</code>
<code>    my (@ops) = @_;</code>
<code>    return $ops[0] * $ops[1];</code>
<code>}</code>
<code> </code>
<code>for my $i (1 .. 10) {</code>
<code>     say "$i squared is ", multiply($i, $i);</code>
<code>}</code></pre>
<h3>Simple matching</h3>
<pre>for my $line (&lt;$urllist&gt;) {
    print $line if $line =~ /^http:.+html$/;
}</pre>
<h3>Flags</h3>
<pre>my $name = 'Wall, Larry';
$name =~ /(\w+), (\w+)/;
# $1 contains last name, $2 contains first name

$name = "$2 $1";
# $name now contains "Larry Wall"</pre>
<p>The string <code>\d{3}</code> means to match exactly three numbers, and <code>\d{4}</code> matches exactly four digits. To use a range of numbers, you can separate them with a comma; leaving out the second number makes the range open-ended. <code>\d{2,5}</code> will match two to five digits, and <code>\w{3,}</code> will match a word that's at least three characters long.</p>
<p>You can also <em>invert</em> the <code>\d</code>, <code>\s</code> and <code>\w</code> metacharacters to refer to anything <em>but</em> that type of character. <code>\D</code> matches nondigits; <code>\W</code> matches any character that <em>isn't</em> a letter, digit, or underscore; and <code>\S</code> matches anything that isn't whitespace.</p>
<pre>my $name = "Damian Conway";
$name = "$+{last} $+{first}" <strong>if</strong> $name =~ /(?&lt;last&gt;\w+), (?&lt;first&gt;\w+)/;</pre>
<h3>Watch out!</h3>
<h3>Search and replace</h3>
<pre>my $name = 'Wall, Larry';
$name =~ s/(\w+), (\w+)/$2 $1/;
# "Larry Wall"
The <code>x</code> flag allows you to use whitespace and comments within regexps, without it being significant to the pattern:
my ($time, $hours, $minutes, $seconds) =
    $string =~ /(                 # capture entire match
                    (\d{1,2})     # one or two digits for the hour
                    :
                    (\d{2})       # two digits for the minutes
                    :
                    (\d{2})       # two digits for the seconds
                )
    /x;</pre>
<p>&nbsp;</p>
<ol>
<li>Function</li>
</ol>
<p>5.1 Bash</p>
<p>function function_name {</p>
<p>command...</p>
<p>}</p>
<p>&nbsp;</p>
<p>或</p>
<p>function_name () {</p>
<p>command...</p>
<p>}</p>
<p>Local xxxx : local avariables</p>
<p>5.2</p>
<p>5.3 Awk</p>
<p>function 函数名(参数表){</p>
<p>函数体</p>
<p>}</p>
<p>Regex</p>
<p>&nbsp;</p>
<ol>
<li>Special Structure</li>
</ol>
<p>6.1 Go</p>
<p>type Vertex struct {</p>
<p>X int</p>
<p>Y int</p>
<p>}</p>
